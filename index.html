<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á–µ—Ç –ø–æ —Ä–∞–±–æ—Ç–µ –≥—Ä—É–ø–ø</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .filters-container {
            padding: 15px 0;
            margin-bottom: 20px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-weight: 500;
            color: #6c757d;
            font-size: 14px;
            white-space: nowrap;
        }

        .date-input {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
            transition: border-color 0.15s ease-in-out;
        }

        .date-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .warning-icon {
            color: #e67e22;
            background-color: #fef9e7;
            padding: 3px 8px;
            border-radius: 50%;
            font-size: 1.2em;
            margin-left: 8px;
            font-weight: bold;
            cursor: help;
            position: relative;
            display: inline-block;
        }

        .warning-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: #fff;
            color: #333;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            top: 100%;
            left: -120px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 1px solid #e0e0e0;
            font-size: 0.9em;
            font-weight: normal;
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 130px;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent #fff transparent;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0069d9;
        }

        .btn-secondary {
            background-color: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background-color: #e9ecef;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ */
        select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background-color: #fff;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            cursor: pointer;
            min-width: 120px;
        }

        select:hover {
            border-color: #adb5bd;
        }

        select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab-button {
            padding: 12px 16px;
            background-color: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .tab-button:hover {
            color: #007bff;
        }

        .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }

        .main-table {
            font-size: 1.1rem;
        }

        .main-table th {
            font-size: 1rem;
            padding: 16px 20px;
        }

        .main-table td {
            padding: 16px 20px;
            font-size: 1.1rem;
        }

        .main-table .expandable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .main-table .expandable-row:hover {
            background-color: #f8f9fa;
        }

        .main-table .detail-row {
            background-color: #e9ecef;
            font-size: 1rem;
        }

        .expand-icon {
            font-size: 0.8rem;
            margin-left: 8px;
            color: #6c757d;
            transition: transform 0.2s ease;
        }

        h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #495057;
        }

        th,
        td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
            font-size: 0.85em;
            text-transform: uppercase;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–µ–π–¥–∂–µ–π */
        .badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.75em;
            margin-left: 6px;
        }

        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        .badge-neutral {
            background-color: #e9ecef;
            color: #6c757d;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ */
        .percentage-high {
            color: #dc3545;
            font-weight: 600;
        }

        .percentage-medium {
            color: #fd7e14;
            font-weight: 600;
        }

        .percentage-low {
            color: #28a745;
            font-weight: 600;
        }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .mt-4 {
            margin-top: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-button active" data-tab="company">–ö–æ–º–ø–∞–Ω–∏—è</button>
            <button class="tab-button" data-tab="departments">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</button>
            <button class="tab-button" data-tab="employees">–ö–æ–º–∞–Ω–¥–∞</button>
        </div>

        <!-- Company Tab Content -->
        <div id="companyTab" class="tab-content active">
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filters-container">
                <div class="filter-group">
                    <div class="filter-item">
                        <span class="filter-label">–ü–µ—Ä–∏–æ–¥ —Å:</span>
                        <input type="date" id="startDate" value="2025-07-01" class="date-input">
                    </div>
                    <div class="filter-item">
                        <span class="filter-label">–ø–æ:</span>
                        <input type="date" id="endDate" value="2025-07-31" class="date-input">
                        <span class="warning-icon">!
                            <span class="tooltip-text">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ –≤—ã–±–æ—Ä–∫–∏:<br>
                                ‚Ä¢ –ú–µ—Å—è—Ü - –º–∞–∫—Å–∏–º—É–º 31 –¥–µ–Ω—å<br>
                                ‚Ä¢ –ù–µ–¥–µ–ª—è - –º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π<br>
                                ‚Ä¢ –î–µ–Ω—å - –º–∞–∫—Å–∏–º—É–º 1 –¥–µ–Ω—å
                            </span>
                        </span>
                    </div>
                </div>

                <div class="filter-group">
                    <div class="filter-item">
                        <span class="filter-label">–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</span>
                        <select id="timeGranularity">
                            <option value="–î–µ–Ω—å">–î–µ–Ω—å</option>
                            <option value="–ù–µ–¥–µ–ª—è">–ù–µ–¥–µ–ª—è</option>
                            <option value="–ú–µ—Å—è—Ü" selected>–ú–µ—Å—è—Ü</option>
                        </select>
                    </div>

                    <div class="filter-item">
                        <select id="callCenter">
                            <option value="–í—Å–µ –ö–¶">–í—Å–µ –ö–¶</option>
                            <option value="–ö–¶ 1">–ö–¶ 1</option>
                            <option value="–ö–¶ 2">–ö–¶ 2</option>
                        </select>
                    </div>

                    <div class="filter-item">
                        <span class="filter-label">–î–∞—à–±–æ—Ä–¥:</span>
                        <select id="dashboard">
                            <option value="–ê–≤—Ç–æ–æ—Ü–µ–Ω–∫–∞" selected>–ê–≤—Ç–æ–æ—Ü–µ–Ω–∫–∞</option>
                            <option value="–ê–≤—Ç–æ–æ—Ü–µ–Ω–∫–∞ –£–ê–í/–ü—Ä–µ–•–∞—Ä–¥">–ê–≤—Ç–æ–æ—Ü–µ–Ω–∫–∞ –£–ê–í/–ü—Ä–µ–•–∞—Ä–¥</option>
                        </select>
                    </div>

                    <div class="filter-item">
                        <button id="updateButton" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ -->
            <div class="warning-icon" style="margin-bottom: 15px; display: inline-block;">
                <span
                    style="background-color: #e3f2fd; color: #1976d2; padding: 8px 12px; border-radius: 4px; font-size: 14px; font-weight: normal;">
                    ‚ÑπÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
                    <span id="periodInfo">(01.06.2025 - 30.06.2025)</span>
                </span>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–≤–æ–¥–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
            <div id="companySummaryTable" class="mt-4">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                <div id="debugInfo"
                    style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 12px;">
                </div>
            </div>
        </div>

        <!-- Departments Tab Content -->
        <div id="departmentsTab" class="tab-content">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ -->
            <div class="warning-icon" style="margin-bottom: 15px; display: inline-block;">
                <span
                    style="background-color: #e3f2fd; color: #1976d2; padding: 8px 12px; border-radius: 4px; font-size: 14px; font-weight: normal;">
                    ‚ÑπÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
                    <span id="departmentsPeriodInfo">(01.06.2025 - 30.06.2025)</span>
                </span>
            </div>
            <div id="departmentsTable" class="mt-4">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
        </div>

        <!-- Employees Tab Content -->
        <div id="employeesTab" class="tab-content">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ -->
            <div class="warning-icon" style="margin-bottom: 15px; display: inline-block;">
                <span
                    style="background-color: #e3f2fd; color: #1976d2; padding: 8px 12px; border-radius: 4px; font-size: 14px; font-weight: normal;">
                    ‚ÑπÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
                    <span id="employeesPeriodInfo">(01.06.2025 - 30.06.2025)</span>
                </span>
            </div>
            <div id="employeesTable" class="mt-4">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript —Ñ–∞–π–ª–æ–≤ -->
    <script src="js/data/real-data-processor.js"></script>

    <script>
        // –û—Ç–ª–∞–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        console.log('=== –û–¢–õ–ê–î–ö–ê –ó–ê–ì–†–£–ó–ö–ò ===');
        console.log('–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');

        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debugInfo');
            if (debugDiv) {
                debugDiv.innerHTML += message + '<br>';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
        setTimeout(() => {
            console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É...');
            updateDebugInfo('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏...');

            const functions = {
                'loadOperatorData': typeof loadOperatorData,
                'getCompanyData': typeof getCompanyData,
                'getDepartmentsData': typeof getDepartmentsData,
                'getEmployeesData': typeof getEmployeesData
            };

            for (const [name, type] of Object.entries(functions)) {
                console.log(`${name}:`, type);
                updateDebugInfo(`${name}: ${type}`);
            }

            // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã, –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            if (typeof loadOperatorData === 'function') {
                updateDebugInfo('–ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ...');

                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º, –º–æ–∂–µ–º –ª–∏ –º—ã –≤–æ–æ–±—â–µ –¥–µ–ª–∞—Ç—å fetch –∑–∞–ø—Ä–æ—Å—ã
                fetch('callcenter_operator_data.json')
                    .then(response => {
                        updateDebugInfo(`Fetch –æ—Ç–≤–µ—Ç: ${response.status} ${response.statusText}`);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response.text();
                    })
                    .then(text => {
                        updateDebugInfo(`–ü–æ–ª—É—á–µ–Ω —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–æ–π: ${text.length} —Å–∏–º–≤–æ–ª–æ–≤`);
                        try {
                            const data = JSON.parse(text);
                            updateDebugInfo(`JSON —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω: ${Object.keys(data).length} –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤`);

                            // –¢–µ–ø–µ—Ä—å –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é
                            return loadOperatorData();
                        } catch (parseError) {
                            updateDebugInfo(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${parseError.message}`);
                            throw parseError;
                        }
                    })
                    .then(data => {
                        if (data) {
                            updateDebugInfo(`‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ loadOperatorData: ${Object.keys(data).length} –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤`);

                            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
                            return getCompanyData('2025-07-01', '2025-07-31', '–ú–µ—Å—è—Ü', '–í—Å–µ –ö–¶');
                        } else {
                            updateDebugInfo('‚ùå loadOperatorData –≤–µ—Ä–Ω—É–ª–∞ null');
                        }
                    })
                    .then(companyData => {
                        if (companyData) {
                            updateDebugInfo(`‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—É—á–µ–Ω—ã: ${companyData.current.total.calls} –∑–≤–æ–Ω–∫–æ–≤`);
                        } else {
                            updateDebugInfo('‚ùå –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã');
                        }
                    })
                    .catch(error => {
                        updateDebugInfo(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                        console.error('–î–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', error);

                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
                        if (error.message.includes('CORS')) {
                            updateDebugInfo('üí° –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä');
                        }
                        if (error.message.includes('file://')) {
                            updateDebugInfo('üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ HTTP —Å–µ—Ä–≤–µ—Ä, –∞ –Ω–µ file://');
                        }
                    });
            } else {
                updateDebugInfo('‚ùå –§—É–Ω–∫—Ü–∏—è loadOperatorData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
        }, 1000);
    </script>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentTab = 'company';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
        function validateDateRange(startDate, endDate, granularity) {
            if (!startDate || !endDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—ã');
                return false;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            let maxDays;
            let errorMessage;

            switch (granularity) {
                case '–î–µ–Ω—å':
                    maxDays = 1;
                    errorMessage = '–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ–∂–∏–º–∞ "–î–µ–Ω—å" –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 1 –¥–µ–Ω—å';
                    break;
                case '–ù–µ–¥–µ–ª—è':
                    maxDays = 7;
                    errorMessage = '–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ–∂–∏–º–∞ "–ù–µ–¥–µ–ª—è" –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 7 –¥–Ω–µ–π';
                    break;
                case '–ú–µ—Å—è—Ü':
                    maxDays = 31;
                    errorMessage = '–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ–∂–∏–º–∞ "–ú–µ—Å—è—Ü" –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 31 –¥–µ–Ω—å';
                    break;
                default:
                    return true;
            }

            if (diffDays > maxDays) {
                alert(errorMessage);
                return false;
            }

            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        function calculateChange(current, previous) {
            if (!previous || previous === 0) {
                return current > 0 ? 100 : 0;
            }

            const change = ((current - previous) / previous) * 100;
            return Math.round(change * 10) / 10;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–π–¥–∂–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
        function createChangeBadge(current, previous) {
            const change = calculateChange(current, previous);
            const sign = change > 0 ? '+' : '';
            const cssClass = change > 0 ? 'badge-success' : (change < 0 ? 'badge-danger' : 'badge-neutral');

            return `<span class="badge ${cssClass}">${sign}${change}%</span>`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSS –∫–ª–∞—Å—Å–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞
        function getPercentageClass(percentage) {
            if (percentage >= 10) {
                return 'percentage-high';
            } else if (percentage >= 5) {
                return 'percentage-medium';
            } else {
                return 'percentage-low';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–∏–æ–¥–µ
        function updatePeriodInfo(granularity, elementId) {
            const periodInfoElement = document.getElementById(elementId);
            if (!periodInfoElement) return;

            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!startDate || !endDate) {
                periodInfoElement.textContent = '(–ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥)';
                return;
            }

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é getPreviousPeriod –∏–∑ real-data-processor.js
            const previousPeriod = getPreviousPeriod(startDate, endDate, granularity);

            let previousPeriodText = '';

            switch (granularity) {
                case '–î–µ–Ω—å':
                    const prevDate = new Date(previousPeriod.startDate);
                    previousPeriodText = `(${prevDate.toLocaleDateString('ru-RU')})`;
                    break;
                case '–ù–µ–¥–µ–ª—è':
                    const prevStartWeek = new Date(previousPeriod.startDate);
                    const prevEndWeek = new Date(previousPeriod.endDate);
                    previousPeriodText = `(${prevStartWeek.toLocaleDateString('ru-RU')} - ${prevEndWeek.toLocaleDateString('ru-RU')})`;
                    break;
                case '–ú–µ—Å—è—Ü':
                    const prevStartMonth = new Date(previousPeriod.startDate);
                    const prevEndMonth = new Date(previousPeriod.endDate);
                    previousPeriodText = `(${prevStartMonth.toLocaleDateString('ru-RU')} - ${prevEndMonth.toLocaleDateString('ru-RU')})`;
                    break;
                default:
                    previousPeriodText = '(–ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥)';
            }

            periodInfoElement.textContent = previousPeriodText;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `<div class="error">–û—à–∏–±–∫–∞: ${message}</div>`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π
        function toggleExpansion(rowId) {
            const detailRows = document.querySelectorAll(`[id^="${rowId}"]`);
            const icon = document.getElementById(rowId.replace('-row', '-icon'));

            let isExpanded = false;
            detailRows.forEach(row => {
                if (row.style.display === 'none' || row.style.display === '') {
                    row.style.display = 'table-row';
                    isExpanded = true;
                } else {
                    row.style.display = 'none';
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            if (icon) {
                icon.textContent = isExpanded ? '‚ñ≤' : '‚ñº';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏
        async function updateCompanyData() {
            console.log('=== updateCompanyData –≤—ã–∑–≤–∞–Ω–∞ ===');

            const granularity = document.getElementById('timeGranularity').value;
            const callCenter = document.getElementById('callCenter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:', { granularity, callCenter, startDate, endDate });

            showLoading('companySummaryTable');
            updatePeriodInfo(granularity, 'periodInfo');

            try {
                console.log('–í—ã–∑—ã–≤–∞–µ–º getCompanyData...');
                const companyData = await getCompanyData(startDate, endDate, granularity, callCenter);
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏:', companyData);

                if (!companyData) {
                    console.error('companyData is null');
                    showError('companySummaryTable', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏');
                    return;
                }

                console.log('–í—ã–∑—ã–≤–∞–µ–º renderCompanyTable...');
                renderCompanyTable(companyData, callCenter);
                console.log('renderCompanyTable –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏:', error);
                showError('companySummaryTable', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∫–æ–º–ø–∞–Ω–∏–∏
        function renderCompanyTable(companyData, selectedCallCenter) {
            const tableContainer = document.getElementById('companySummaryTable');
            if (!tableContainer) return;

            let tableHTML = '';

            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –≤—Å–µ –ö–¶, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–±–∏–≤–∫—É –ø–æ –ö–¶
            if (selectedCallCenter === '–í—Å–µ –ö–¶') {
                const currentData = companyData.current;
                const previousData = companyData.previous;

                const totalData = currentData.total;
                const kc1Data = currentData.kc1;
                const kc2Data = currentData.kc2;
                const rpcTotalData = currentData.rpc.total;
                const nonRpcTotalData = currentData.nonRpc.total;
                const rpcKc1Data = currentData.rpc.kc1;
                const nonRpcKc1Data = currentData.nonRpc.kc1;
                const rpcKc2Data = currentData.rpc.kc2;
                const nonRpcKc2Data = currentData.nonRpc.kc2;

                // –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
                const prevTotalData = previousData.total;
                const prevKc1Data = previousData.kc1;
                const prevKc2Data = previousData.kc2;
                const prevRpcTotalData = previousData.rpc.total;
                const prevNonRpcTotalData = previousData.nonRpc.total;
                const prevRpcKc1Data = previousData.rpc.kc1;
                const prevNonRpcKc1Data = previousData.nonRpc.kc1;
                const prevRpcKc2Data = previousData.rpc.kc2;
                const prevNonRpcKc2Data = previousData.nonRpc.kc2;

                tableHTML = `
                    <table class="main-table">
                        <thead>
                            <tr>
                                <th>–ö–û–õ–õ-–¶–ï–ù–¢–†</th>
                                <th class="text-right">–í–°–ï–ì–û –ó–í–û–ù–ö–û–í</th>
                                <th class="text-right">–û–¢–ö–õ–û–ù–ï–ù–ò–Ø</th>
                                <th class="text-right">% –û–¢–ö–õ–û–ù–ï–ù–ò–ô</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="expandable-row" onclick="toggleExpansion('total-row')">
                                <td><strong>–í—Å–µ–≥–æ</strong> <span class="expand-icon" id="total-icon">‚ñº</span></td>
                                <td class="text-right"><strong>${totalData.calls.toLocaleString()}</strong> ${createChangeBadge(totalData.calls, prevTotalData.calls)}</td>
                                <td class="text-right"><strong>${totalData.deviations.toLocaleString()}</strong> ${createChangeBadge(totalData.deviations, prevTotalData.deviations)}</td>
                                <td class="text-right"><strong><span class="${getPercentageClass(totalData.percentage)}">${totalData.percentage}%</span></strong> ${createChangeBadge(totalData.percentage, prevTotalData.percentage)}</td>
                            </tr>
                            <tr class="detail-row" id="total-row" style="display: none;">
                                <td style="padding-left: 30px;">RPC</td>
                                <td class="text-right">${rpcTotalData.calls.toLocaleString()} ${createChangeBadge(rpcTotalData.calls, prevRpcTotalData.calls)}</td>
                                <td class="text-right">${rpcTotalData.deviations.toLocaleString()} ${createChangeBadge(rpcTotalData.deviations, prevRpcTotalData.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(rpcTotalData.percentage)}">${rpcTotalData.percentage}%</span> ${createChangeBadge(rpcTotalData.percentage, prevRpcTotalData.percentage)}</td>
                            </tr>
                            <tr class="detail-row" id="total-row-2" style="display: none;">
                                <td style="padding-left: 30px;">–ù–µ RPC</td>
                                <td class="text-right">${nonRpcTotalData.calls.toLocaleString()} ${createChangeBadge(nonRpcTotalData.calls, prevNonRpcTotalData.calls)}</td>
                                <td class="text-right">${nonRpcTotalData.deviations.toLocaleString()} ${createChangeBadge(nonRpcTotalData.deviations, prevNonRpcTotalData.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(nonRpcTotalData.percentage)}">${nonRpcTotalData.percentage}%</span> ${createChangeBadge(nonRpcTotalData.percentage, prevNonRpcTotalData.percentage)}</td>
                            </tr>
                            <tr class="expandable-row" onclick="toggleExpansion('kc1-row')">
                                <td>–ö–¶ 1 <span class="expand-icon" id="kc1-icon">‚ñº</span></td>
                                <td class="text-right">${kc1Data.calls.toLocaleString()} ${createChangeBadge(kc1Data.calls, prevKc1Data.calls)}</td>
                                <td class="text-right">${kc1Data.deviations.toLocaleString()} ${createChangeBadge(kc1Data.deviations, prevKc1Data.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(kc1Data.percentage)}">${kc1Data.percentage}%</span> ${createChangeBadge(kc1Data.percentage, prevKc1Data.percentage)}</td>
                            </tr>
                            <tr class="detail-row" id="kc1-row" style="display: none;">
                                <td style="padding-left: 30px;">RPC</td>
                                <td class="text-right">${rpcKc1Data.calls.toLocaleString()} ${createChangeBadge(rpcKc1Data.calls, prevRpcKc1Data.calls)}</td>
                                <td class="text-right">${rpcKc1Data.deviations.toLocaleString()} ${createChangeBadge(rpcKc1Data.deviations, prevRpcKc1Data.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(rpcKc1Data.percentage)}">${rpcKc1Data.percentage}%</span> ${createChangeBadge(rpcKc1Data.percentage, prevRpcKc1Data.percentage)}</td>
                            </tr>
                            <tr class="detail-row" id="kc1-row-2" style="display: none;">
                                <td style="padding-left: 30px;">–ù–µ RPC</td>
                                <td class="text-right">${nonRpcKc1Data.calls.toLocaleString()} ${createChangeBadge(nonRpcKc1Data.calls, prevNonRpcKc1Data.calls)}</td>
                                <td class="text-right">${nonRpcKc1Data.deviations.toLocaleString()} ${createChangeBadge(nonRpcKc1Data.deviations, prevNonRpcKc1Data.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(nonRpcKc1Data.percentage)}">${nonRpcKc1Data.percentage}%</span> ${createChangeBadge(nonRpcKc1Data.percentage, prevNonRpcKc1Data.percentage)}</td>
                            </tr>
                            <tr class="expandable-row" onclick="toggleExpansion('kc2-row')">
                                <td>–ö–¶ 2 <span class="expand-icon" id="kc2-icon">‚ñº</span></td>
                                <td class="text-right">${kc2Data.calls.toLocaleString()} ${createChangeBadge(kc2Data.calls, prevKc2Data.calls)}</td>
                                <td class="text-right">${kc2Data.deviations.toLocaleString()} ${createChangeBadge(kc2Data.deviations, prevKc2Data.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(kc2Data.percentage)}">${kc2Data.percentage}%</span> ${createChangeBadge(kc2Data.percentage, prevKc2Data.percentage)}</td>
                            </tr>
                            <tr class="detail-row" id="kc2-row" style="display: none;">
                                <td style="padding-left: 30px;">RPC</td>
                                <td class="text-right">${rpcKc2Data.calls.toLocaleString()} ${createChangeBadge(rpcKc2Data.calls, prevRpcKc2Data.calls)}</td>
                                <td class="text-right">${rpcKc2Data.deviations.toLocaleString()} ${createChangeBadge(rpcKc2Data.deviations, prevRpcKc2Data.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(rpcKc2Data.percentage)}">${rpcKc2Data.percentage}%</span> ${createChangeBadge(rpcKc2Data.percentage, prevRpcKc2Data.percentage)}</td>
                            </tr>
                            <tr class="detail-row" id="kc2-row-2" style="display: none;">
                                <td style="padding-left: 30px;">–ù–µ RPC</td>
                                <td class="text-right">${nonRpcKc2Data.calls.toLocaleString()} ${createChangeBadge(nonRpcKc2Data.calls, prevNonRpcKc2Data.calls)}</td>
                                <td class="text-right">${nonRpcKc2Data.deviations.toLocaleString()} ${createChangeBadge(nonRpcKc2Data.deviations, prevNonRpcKc2Data.deviations)}</td>
                                <td class="text-right"><span class="${getPercentageClass(nonRpcKc2Data.percentage)}">${nonRpcKc2Data.percentage}%</span> ${createChangeBadge(nonRpcKc2Data.percentage, prevNonRpcKc2Data.percentage)}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            } else {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ö–¶, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
                const currentData = companyData.current;
                const previousData = companyData.previous;

                const kcKey = selectedCallCenter === '–ö–¶ 1' ? 'kc1' : 'kc2';
                const totalData = currentData[kcKey];
                const rpcData = currentData.rpc[kcKey];
                const nonRpcData = currentData.nonRpc[kcKey];

                const prevTotalData = previousData[kcKey];
                const prevRpcData = previousData.rpc[kcKey];
                const prevNonRpcData = previousData.nonRpc[kcKey];

                tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>–ü–ê–†–ê–ú–ï–¢–†</th>
                                <th class="text-right">–í–°–ï–ì–û</th>
                                <th class="text-right">RPC</th>
                                <th class="text-right">–ù–ï RPC</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>–û—Ü–µ–Ω–µ–Ω–æ –∑–≤–æ–Ω–∫–æ–≤</td>
                                <td class="text-right">${totalData.calls.toLocaleString()} ${createChangeBadge(totalData.calls, prevTotalData.calls)}</td>
                                <td class="text-right">${rpcData.calls.toLocaleString()} ${createChangeBadge(rpcData.calls, prevRpcData.calls)}</td>
                                <td class="text-right">${nonRpcData.calls.toLocaleString()} ${createChangeBadge(nonRpcData.calls, prevNonRpcData.calls)}</td>
                            </tr>
                            <tr>
                                <td>–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –≤—ã—è–≤–ª–µ–Ω–æ</td>
                                <td class="text-right">${totalData.deviations.toLocaleString()} ${createChangeBadge(totalData.deviations, prevTotalData.deviations)}</td>
                                <td class="text-right">${rpcData.deviations.toLocaleString()} ${createChangeBadge(rpcData.deviations, prevRpcData.deviations)}</td>
                                <td class="text-right">${nonRpcData.deviations.toLocaleString()} ${createChangeBadge(nonRpcData.deviations, prevNonRpcData.deviations)}</td>
                            </tr>
                            <tr>
                                <td>% –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π</td>
                                <td class="text-right"><span class="${getPercentageClass(totalData.percentage)}">${totalData.percentage}%</span> ${createChangeBadge(totalData.percentage, prevTotalData.percentage)}</td>
                                <td class="text-right"><span class="${getPercentageClass(rpcData.percentage)}">${rpcData.percentage}%</span> ${createChangeBadge(rpcData.percentage, prevRpcData.percentage)}</td>
                                <td class="text-right"><span class="${getPercentageClass(nonRpcData.percentage)}">${nonRpcData.percentage}%</span> ${createChangeBadge(nonRpcData.percentage, prevNonRpcData.percentage)}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            tableContainer.innerHTML = tableHTML;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
        async function updateDepartmentsData() {
            const granularity = document.getElementById('timeGranularity').value;
            const callCenter = document.getElementById('callCenter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            showLoading('departmentsTable');
            updatePeriodInfo(granularity, 'departmentsPeriodInfo');

            try {
                const departmentsData = await getDepartmentsData(startDate, endDate, granularity, callCenter);

                if (!departmentsData) {
                    showError('departmentsTable', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π');
                    return;
                }

                renderDepartmentsTable(departmentsData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π:', error);
                showError('departmentsTable', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
        function renderDepartmentsTable(departmentsData) {
            const tableContainer = document.getElementById('departmentsTable');
            if (!tableContainer) return;

            let tableHTML = `
                <h4>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</h4>
                <table>
                    <thead>
                        <tr>
                            <th>–ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–ï</th>
                            <th class="text-right">–ö–û–ù–¢–ê–ö–¢-–¶–ï–ù–¢–†</th>
                            <th class="text-right">–û–¶–ï–ù–ï–ù–û –ó–í–û–ù–ö–û–í</th>
                            <th class="text-right">–û–¢–ö–õ–û–ù–ï–ù–ò–ô</th>
                            <th class="text-right">% –û–¢–ö–õ–û–ù–ï–ù–ò–ô</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            departmentsData.current.forEach((dept, index) => {
                const prevDept = departmentsData.previous[index] || { calls: 0, deviations: 0, percentage: 0 };

                tableHTML += `
                    <tr>
                        <td>${dept.name}</td>
                        <td class="text-right">${dept.callCenter}</td>
                        <td class="text-right">${dept.calls.toLocaleString()} ${createChangeBadge(dept.calls, prevDept.calls)}</td>
                        <td class="text-right">${dept.deviations.toLocaleString()} ${createChangeBadge(dept.deviations, prevDept.deviations)}</td>
                        <td class="text-right"><span class="${getPercentageClass(dept.percentage)}">${dept.percentage}%</span> ${createChangeBadge(dept.percentage, prevDept.percentage)}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            tableContainer.innerHTML = tableHTML;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        async function updateEmployeesData() {
            const granularity = document.getElementById('timeGranularity').value;
            const callCenter = document.getElementById('callCenter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            showLoading('employeesTable');
            updatePeriodInfo(granularity, 'employeesPeriodInfo');

            try {
                const employeesData = await getEmployeesData(startDate, endDate, granularity, callCenter);

                if (!employeesData) {
                    showError('employeesTable', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');
                    return;
                }

                renderEmployeesTable(employeesData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', error);
                showError('employeesTable', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function renderEmployeesTable(employeesData) {
            const tableContainer = document.getElementById('employeesTable');
            if (!tableContainer) return;

            let tableHTML = `
                <h4>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h4>
                <table>
                    <thead>
                        <tr>
                            <th>–°–û–¢–†–£–î–ù–ò–ö</th>
                            <th>–ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–ï</th>
                            <th class="text-right">–ö–¶</th>
                            <th class="text-right">–û–¶–ï–ù–ï–ù–û –ó–í–û–ù–ö–û–í</th>
                            <th class="text-right">–û–¢–ö–õ–û–ù–ï–ù–ò–ô</th>
                            <th class="text-right">% –û–¢–ö–õ–û–ù–ï–ù–ò–ô</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            employeesData.current.forEach((emp, index) => {
                const prevEmp = employeesData.previous[index] || { calls: 0, deviations: 0, percentage: 0 };

                tableHTML += `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${emp.department}</td>
                        <td class="text-right">${emp.callCenter}</td>
                        <td class="text-right">${emp.calls.toLocaleString()} ${createChangeBadge(emp.calls, prevEmp.calls)}</td>
                        <td class="text-right">${emp.deviations.toLocaleString()} ${createChangeBadge(emp.deviations, prevEmp.deviations)}</td>
                        <td class="text-right"><span class="${getPercentageClass(emp.percentage)}">${emp.percentage}%</span> ${createChangeBadge(emp.percentage, prevEmp.percentage)}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            tableContainer.innerHTML = tableHTML;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        async function updateActiveTab() {
            console.log('=== updateActiveTab –≤—ã–∑–≤–∞–Ω–∞ ===');
            console.log('currentTab:', currentTab);

            switch (currentTab) {
                case 'company':
                    console.log('–û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏...');
                    await updateCompanyData();
                    break;
                case 'departments':
                    console.log('–û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π...');
                    await updateDepartmentsData();
                    break;
                case 'employees':
                    await updateEmployeesData();
                    break;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function () {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const tabId = this.getAttribute('data-tab');

                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–∫–ª–∞–¥–æ–∫
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
                    this.classList.add('active');
                    document.getElementById(tabId + 'Tab').classList.add('active');

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
                    currentTab = tabId;

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                    setTimeout(updateActiveTab, 100);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å"
            document.getElementById('updateButton').addEventListener('click', async function () {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const granularity = document.getElementById('timeGranularity').value;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
                if (!validateDateRange(startDate, endDate, granularity)) {
                    return;
                }

                await updateActiveTab();
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('timeGranularity').addEventListener('change', updateActiveTab);
            document.getElementById('callCenter').addEventListener('change', updateActiveTab);

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            setTimeout(updateActiveTab, 500);
        });
    </script>
</body>

</html>